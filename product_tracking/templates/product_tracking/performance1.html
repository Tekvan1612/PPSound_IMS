{% load static %}
{% include 'product_tracking/head.html' %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
    .table-responsive {
    max-height: 800px;
    overflow-y: auto;
}
    .modal-dialog {
    max-width: 75%; /* Ensures the modal doesn't exceed screen width */
    margin: 1.75rem auto; /* Centers the modal with some margin on top and bottom */
}

.modal-content {
    padding: 15px;
}

.modal-body {
    padding-bottom: 10px;
    overflow-y: scroll; /* Enables scrolling if content overflows */
    max-height: 85vh; /* Limits the modal height to 70% of the viewport height */
}

@media (min-width: 768px) {
    .modal-lg {
        max-width: 80%; /* Adjusts for larger screens */
    }

    .modal-body {
        max-height: 80vh; /* Increases max height for larger screens */
    }
}

@media (max-width: 767.98px) {
    .modal-dialog {
        max-width: 100%; /* Ensures modal fits within small screens */
        margin: 10px; /* Adds some margin for extra small devices */
    }
    .modal-body {
        max-height: 60vh; /* Reduces max height for smaller screens */
    }
}

@media (max-width: 575.98px) {
    .modal-content {
        padding: 10px; /* Reduces padding for small screens */
    }
    .modal-body {
        max-height: 50vh; /* Further reduces max height for extra small screens */
    }
}

.nav-tabs .nav-link {
    font-size: 1rem;
    border-radius: 5px;
    font-weight: 600;
    padding: 10px 20px;
    color: #495057;
    transition: background-color 0.3s ease, color 0.3s ease;
}
.btn-primary {
    background-color: #007bff;
    border-color: #007bff;
    color: #ffffff;
}

.btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
    color: #ffffff;
}

.btn-danger {
    background-color: #dc3545;
    border-color: #dc3545;
    color: #ffffff;
}

.nav-tabs .nav-link.active {
    color: #fff !important;
    background-color: #007bff !important;
    border-color: #007bff #007bff #fff !important;
    border-radius: 5px;
}

.table thead th {
    background-color: #343a40; /* Dark background for table headers */
    color: #ffffff; /* White text color for headers */
    border-bottom: 2px solid #dee2e6;
}
.table tbody td {
    color: #212529; /* Dark text for table data */
    border-top: 1px solid #dee2e6;
}

.plus-icon {
    cursor: pointer;
    color: #ffffff;
    text-align: center;
    display: inline-block;
    width: 100%;
    font-size: 1.2rem;
}
.table .edit-btn,
.table .save-btn,
.table .cancel-btn,
.table .delete-btn {
    font-size: 1rem;
    padding: 5px 10px;
    cursor: pointer;
}

.editable-cell {
    cursor: pointer;
}

.form-inline {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 10px;
}
.form-control {
    border: 1px solid #ced4da; /* Border color for inputs */
    border-radius: 5px; /* Rounded corners */
    padding: 10px;
    font-size: 1rem;
}
.form-label {
    font-weight: 600;
    font-size: 0.875rem; /* Slightly smaller label size */
}

.custom-margin {
    margin-top: 10px; /* Keep the margin controlled */
}

.modal-dialog {
    max-width: 75%;
    margin: 1.75rem auto;
}

.modal-content {
    padding: 15px;
}

.modal-header {
    background-color: #343a40;
    color: #ffffff;
    border-bottom: 1px solid #dee2e6;
}

.modal-footer {
    border-top: 1px solid #dee2e6;
    padding-top: 10px;
}
.col-xl-4, .col-lg-4, .col-md-6, .col-xl-3 {
    padding-left: 5px;
    padding-right: 5px;
}

.custom-margin {
    margin-top: 5px; /* Reduced margin to minimize space taken */
}

#attachments .col-md-4 {
    padding-left: 5px;
    padding-right: 5px;
}
.modal-body {
    overflow-y: auto;
    max-height: 60vh; /* Adjust this value to suit your design */
}

@media (min-width: 768px) {
    .modal-body {
        max-height: 70vh; /* Higher height for larger screens */
    }
}
textarea {
    max-height: 150px; /* Limit the height of text areas */
    overflow-y: auto;
}

#attachments img {
    max-width: 100%; /* Ensures images do not overflow */
    height: auto; /* Maintains aspect ratio */
}


</style>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    $(document).ready(function () {
         document.getElementById('addEquipmentRow').addEventListener('click', function() {
            var myModal = new bootstrap.Modal(document.getElementById('categoryModal'));
            myModal.show();
        });
    console.log("jQuery version:", $.fn.jquery);

    // Load existing data
    loadMasterCategoryList();
    loadSubCategoryList();
    loadEquipmentList();
    fetchSubCategories();
    loadStockDetails();
    fetchSubEditCategories();    


    // Master Category Section
    function activateEditMode(row) {
        row.find('td').each(function (index, element) {
            const cell = $(element);

            if (cell.data('editable') === true) {
                const text = cell.text();
                cell.html('<input type="text" class="form-control" value="' + text + '">');
            } else if (cell.data('editable-select') === true) {
                const statusText = cell.text().trim();
                const status = statusText === 'Active' ? '1' : '0';
                cell.html('<select class="form-control"><option value="1" ' + (status === '1' ? 'selected' : '') + '>Active</option><option value="0" ' + (status === '0' ? 'selected' : '') + '>Inactive</option></select>');
            }
        });

        // Hide the Edit button and show Save/Cancel buttons
        row.find('.edit-btn, .delete-btn').hide();
        row.find('.save-btn, .cancel-btn').show();

        // Attach event handler to the Cancel button
        row.find('.cancel-btn').on('click', function () {
            row.remove(); // Remove the row from the UI
        });
    }

    function cancelEditMode(row) {
        row.find('td').each(function (index, element) {
            const cell = $(element);

            if (cell.data('editable') === true) {
                const input = cell.find('input');
                if (input.length) {
                    const value = input.val();
                    cell.text(value);
                }
            } else if (cell.data('editable-select') === true) {
                const select = cell.find('select');
                if (select.length) {
                    const value = select.val();
                    cell.text(value === '1' ? 'Active' : 'Inactive');
                }
            }
        });
        // Show the Edit button and hide Save/Cancel buttons
        row.find('.edit-btn, .delete-btn').show();
        row.find('.save-btn, .cancel-btn').hide();
    }

    // Adding new row for Master Category
    $(document).on('click', '#addMasterCategoryRow', function () {
        const newRow = `
            <tr class="editable-row">
                <td>
                    <button class="btn btn-success save-btn" style="display:none;"><i class="fa fa-save"></i></button>
                    <button class="btn btn-secondary cancel-btn" style="display:none;"><i class="fa fa-times"></i></button>
                    <button class="btn btn-primary edit-btn"><i class="fa fa-pencil"></i></button>
                    <button class="btn btn-danger delete-btn"><i class="fa fa-trash"></i></button>
                </td>
                <td data-editable="true"><input type="text" class="form-control"></td>
                <td></td>
                <td></td>
                <td data-editable-select="true">
                    <select class="form-control">
                        <option value="1" selected>Active</option>
                        <option value="0">Inactive</option>
                    </select>
                </td>
            </tr>
        `;

        const $newRow = $(newRow); // Wrap the string with jQuery to create a jQuery object
        $('#master-category-table-body').prepend($newRow); // Append the new row to the table

        activateEditMode($newRow); // Activate edit mode for the new row

        // Ensure the default value is set properly
        $newRow.find('select').val('1'); // Set 'Active' as the default selected value
    });

    // Function to load master category list
    function loadMasterCategoryList() {
        $.ajax({
            url: '{% url "category_list" %}',
            type: 'GET',
            success: function (response) {
                if (response && response.categories) {
                    $('#master-category-table-body').empty();
                    response.categories.forEach(function (category) {
                        // Check if category.id is valid
                        if (category.id) {
                            $('#master-category-table-body').append(`
                        <tr class="editable-row" data-category-id="${category.id}">
                            <td>
                                <button class="btn btn-sm btn-primary edit-list-btn me-2" data-toggle="tooltip" title="Edit"><i class="fa fa-pencil"></i></button>
                                <button class="btn btn-sm btn-success edit-save-btn me-2" style="display:none;" data-toggle="tooltip" title="Save"><i class="fa fa-save"></i></button>
                                <button class="btn btn-sm btn-secondary edit-cancel-btn me-2" style="display:none;" data-toggle="tooltip" title="Cancel"><i class="fa fa-times"></i></button>
                                <button class="btn btn-sm btn-danger delete-btn me-2" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></button>
                            </td>
                            <td data-editable="true">${category.category_name}</td>
                            <td>${category.created_by}</td>
                            <td>${category.created_date}</td>
                            <td data-editable-select="true">${category.status ? 'Active' : 'Inactive'}</td>
                        </tr>
                    `);
                        } else {
                            console.error('Category ID is missing:', category);
                        }
                    });
                } else {
                    console.error('Response is missing categories or is undefined:', response);
                }
            },
            error: function (xhr, status, error) {
                console.error('Error loading master category list:', error);
            }
        });
    }

    $(document).on('click', '.edit-btn', function () {
        const row = $(this).closest('tr');
        activateEditMode(row);
    });

    $(document).on('click', '.save-btn', function () {
        const row = $(this).closest('tr');
        saveRowData(row);
        location.reload(); // Consider removing this if it causes unintended behavior
    });

    // Function to save row data
    function saveRowData(row) {
        const categoryId = row.data('category-id');
        const inputElement = row.find('td[data-editable="true"] input');
        const selectElement = row.find('td[data-editable-select="true"] select');

        if (inputElement.length === 0 || selectElement.length === 0) {
            console.error("Input or select element not found in the row.");
            return;
        }

        const categoryName = inputElement.val().trim();
        const status = selectElement.val();

        if (!categoryName) {
            alert("Category name cannot be empty.");
            return;
        }

        const csrfToken = getCookie('csrftoken');
        const url = categoryId ? `/update_category/${categoryId}/` : '{% url "add_category" %}';

        $.ajax({
            url: url,
            type: 'POST',
            data: {
                'category_name': categoryName,
                'status': status,
                'csrfmiddlewaretoken': csrfToken
            },
            success: function (response) {
                if (response.success) {
                    alert('Category saved successfully!');
                    row.find('td:eq(1)').text(categoryName);
                    row.find('td:eq(4)').text(status === '1' ? 'Active' : 'Inactive');
                    cancelEditMode(row); // Exit edit mode after saving
                } else if (response.message === 'Category already exists') {
                    alert('Category name already exists. Please choose a different name.');
                } else {
                    alert('Error: ' + response.message);
                }
            },
            error: function (xhr, status, error) {
                alert('An error occurred: ' + error);
            }
        });
    }

    $(document).on('click', '.edit-list-btn', function() {
        const row = $(this).closest('tr');
        row.find('td[data-editable]').each(function() {
            const cell = $(this);
            const text = cell.text();
            cell.html(`<input type="text" value="${text}" class="form-control">`);
        });
        row.find('.edit-list-btn, .delete-btn').hide();
        row.find('.edit-save-btn, .edit-cancel-btn').show();
    });

    $(document).on('click', '.edit-save-btn', function() {
        const row = $(this).closest('tr');
        const categoryId = row.data('category-id');
        const updatedData = {
            categoryName: row.find('td:eq(1) input').val(),
        };
        updateCategory(categoryId, updatedData, $('input[name="csrfmiddlewaretoken"]').val());
    });

    function getCsrfToken() {
        return $('meta[name="csrf-token"]').attr('content');
    }

    function updateCategory(categoryId, updatedData) {
        $.ajax({
            url: `/update_master_category/${categoryId}/`,
            type: 'POST',
            headers: {
                'X-CSRFToken': getCsrfToken()
            },
            data: {
                'category_name': updatedData.categoryName,
            },
            success: function(response) {
                if (response.success) {
                    const row = $(`tr[data-category-id="${categoryId}"]`);
                    row.find('td:eq(1)').text(updatedData.categoryName);
                    row.find('.edit-save-btn, .edit-cancel-btn').hide();
                    row.find('.edit-list-btn').show();
                    alert('Category updated successfully!');
                    location.reload(); // Consider removing this if it causes unintended behavior
                } else {
                    alert('Error: ' + response.message);
                }
            },
            error: function(xhr, status, error) {
                alert('An error occurred: ' + xhr.responseText);
            }
        });
    }

    $(document).on('click', '.delete-btn', function () {
        const row = $(this).closest('tr');
        const categoryId = row.data('category-id');

        if (categoryId) {
            if (confirm("Are you sure you want to delete this category?")) {
                const csrfToken = getCookie('csrftoken');
                deleteCategory(categoryId, csrfToken, row);
            }
        } else {
            // If the row is newly added and not saved yet, just remove it
            row.remove();
        }
    });

    function deleteCategory(categoryId, csrfToken, row) {
        $.ajax({
            url: `/delete_category/${categoryId}/`,
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': csrfToken
            },
            success: function (response) {
                if (response.success) {
                    row.remove();
                    alert('Category deleted successfully!');
                } else {
                    if (response.message.includes('Cannot delete category.')) {
                        alert('Cannot delete category');
                    } else {
                        alert('Error: ' + response.message);
                    }
                }
            },
            error: function (xhr, status, error) {
                try {
                    const errorResponse = JSON.parse(xhr.responseText);
                    if (errorResponse.message.includes('Cannot delete category')) {
                        alert('Cannot Delete Category.!!');
                    } else {
                        alert('An error occurred: ' + errorResponse.message);
                    }
                } catch (e) {
                    alert('An unexpected error occurred.');
                }
            }
        });
    }

    // Sub Category Section
    function activateSubEditMode(row) {
        row.find('td').each(function (index, element) {
            const cell = $(element);

            if (cell.data('editable') === true) {
                const text = cell.text();
                cell.html('<input type="text" class="form-control" value="' + text + '">');
            } else if (cell.data('editable-select') === true) {
                const statusText = cell.text().trim();
                const status = statusText === 'Active' ? '1' : '0';
                cell.html('<select class="form-control"><option value="1" ' + (status === '1' ? 'selected' : '') + '>Active</option><option value="0" ' + (status === '0' ? 'selected' : '') + '>Inactive</option></select>');
            }
        });

        // Hide the Edit button and show Save/Cancel buttons
        row.find('.edit-sub-btn, .delete-sub-btn').hide();
        row.find('.save-sub-btn, .cancel-sub-btn').show();

        // Attach event handler to the Cancel button
        row.find('.cancel-sub-btn').on('click', function () {
            row.remove(); // Remove the row from the UI
        });
    }

    function cancelSubEditMode(row) {
        row.find('td').each(function (index, element) {
            const cell = $(element);

            if (cell.data('editable') === true) {
                const input = cell.find('input');
                if (input.length) {
                    const value = input.val();
                    cell.text(value);
                }
            } else if (cell.data('editable-select') === true) {
                const select = cell.find('select');
                if (select.length) {
                    const value = select.val();
                    cell.text(value === '1' ? 'Active' : 'Inactive');
                }
            }
        });
        row.find('.edit-sub-btn, .delete-sub-btn').show();
        row.find('.save-sub-btn, .cancel-sub-btn').hide();
    }

    $(document).on('click', '#addSubcategoryRow', function () {
        const newRow = `
            <tr class="editable-sub-row">
                <td>
                    <button class="btn btn-success save-sub-btn" style="display:none;"><i class="fa fa-save"></i></button>
                    <button class="btn btn-secondary cancel-sub-btn" style="display:none;"><i class="fa fa-times"></i></button>
                    <button class="btn btn-primary edit-sub-btn"><i class="fa fa-pencil"></i></button>
                    <button class="btn btn-danger delete-sub-btn"><i class="fa fa-trash"></i></button>
                </td>
                <td data-editable="true"><input type="text" class="form-control"></td>
                <td>
                    <select class="form-control category-dropdown">
                        <option value="">Select Category</option>
                    </select>
                </td>
                <td></td>
                <td></td>
                <td data-editable-select="true">
                    <select class="form-control">
                        <option value="1" selected>Active</option>
                        <option value="0">Inactive</option>
                    </select>
                </td>
            </tr>
        `;

        const $newRow = $(newRow);
        $('#subcategory-table-body').prepend($newRow);

        activateSubEditMode($newRow);

        $newRow.find('select').val('1');

        // Fetch and populate category dropdown
        $.ajax({
            url: '/fetch-categories/',
            method: 'GET',
            success: function (response) {
                const categoryDropdown = $newRow.find('.category-dropdown');
                categoryDropdown.empty();
                categoryDropdown.append('<option value="">Select Category</option>');

                response.categories.forEach(function (category) {
                    categoryDropdown.append(`<option value="${category.category_id}">${category.category_name}</option>`);
                });

                categoryDropdown.find('option').each(function () {
                    console.log('Category ID:', $(this).val(), 'Category Name:', $(this).text());
                });
            },
            error: function () {
                console.error('Failed to fetch categories.');
            }
        });
    });

    $(document).on('click', '.edit-sub-btn', function () {
        const row = $(this).closest('tr');
        activateSubEditMode(row);
    });

    $(document).on('click', '.save-sub-btn', function () {
        const row = $(this).closest('tr');
        saveSubRowData(row);
        location.reload(); // Consider removing this if it causes unintended behavior
    });

    function saveSubRowData(row) {
        const inputElement = row.find('td[data-editable="true"] input');
        const selectElement = row.find('td[data-editable-select="true"] select');
        const categoryDropdown = row.find('.category-dropdown');

        if (inputElement.length === 0 || selectElement.length === 0 || categoryDropdown.length === 0) {
            console.error("Input, select, or category dropdown element not found in the row.");
            return;
        }

        const subCategoryName = inputElement.val().trim();
        const status = selectElement.val();
        const categoryId = categoryDropdown.val();

        if (!subCategoryName) {
            alert("Subcategory name cannot be empty.");
            return;
        }

        if (!categoryId) {
            alert("Please select a category.");
            return;
        }

        const csrfToken = getCookie('csrftoken');
        const url = '{% url "add_subcategory" %}';

        $.ajax({
            url: url,
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                'category_id': categoryId,
                'subcategory_name': subCategoryName,
                'status': status,
            }),
            beforeSend: function (xhr, settings) {
                xhr.setRequestHeader("X-CSRFToken", csrfToken);
            },
            success: function (response) {
                if (response.success) {
                    alert('Subcategory saved successfully!');
                    row.find('td:eq(1)').text(subCategoryName);
                    row.find('td:eq(4)').text(status === '1' ? 'Active' : 'Inactive');
                    cancelSubEditMode(row);
                } else if (response.message === 'Sub Category already exists') {
                    alert('Sub Category name already exists. Please choose a different name.');
                } else {
                    alert('Error: ' + response.message);
                }
            },
            error: function (xhr, status, error) {
                alert('An error occurred: ' + error);
            }
        });
    }
function loadSubCategoryList() {
    $.ajax({
        url: '{% url "subcategorytest_list" %}',
        type: 'GET',
        success: function (response) {
            $('#subcategory-table-body').empty();
            response.subcategories.forEach(function (subcategory) {
                $('#subcategory-table-body').append(`
                    <tr class="editable-sub-row" data-subcategory-id="${subcategory.id}">
                        <td>
                            <button class="btn btn-sm btn-primary edit-list-sub-btn me-2" data-toggle="tooltip" title="Edit"><i class="fa fa-pencil"></i></button>
                            <button class="btn btn-sm btn-success save-sub-list-btn me-2" style="display:none;" data-toggle="tooltip" title="Save"><i class="fa fa-save"></i></button>
                            <button class="btn btn-sm btn-secondary cancel-sub-list-btn me-2" style="display:none;" data-toggle="tooltip" title="Cancel"><i class="fa fa-times"></i></button>
                            <button class="btn btn-sm btn-danger delete-sub-list-btn me-2" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></button>
                        </td>
                        <td data-editable="true">${subcategory.name}</td>
                        <td>${subcategory.category_name}</td>
                        <td>${subcategory.created_by}</td>
                        <td>${subcategory.created_date}</td>
                        <td data-editable-select="true">${subcategory.status ? 'Active' : 'Inactive'}</td>
                    </tr>
                `);
            });
        },
        error: function (xhr, status, error) {
            console.error('Error loading subcategory list:', error);
        }
    });
}

$(document).on('click', '.edit-list-sub-btn', function() {
    const row = $(this).closest('tr');
    row.find('td[data-editable]').each(function() {
        const cell = $(this);
        const text = cell.text();
        cell.html(`<input type="text" value="${text}" class="form-control">`);
    });
    row.find('td[data-editable-select]').each(function() {
        const cell = $(this);
        const text = cell.text();
        const isActive = text.trim() === 'Active';
        cell.html(`
            <select class="form-control">
                <option value="true" ${isActive ? 'selected' : ''}>Active</option>
                <option value="false" ${!isActive ? 'selected' : ''}>Inactive</option>
            </select>
        `);
    });
    row.find('.edit-list-sub-btn, .delete-sub-list-btn').hide();
    row.find('.save-sub-list-btn, .cancel-sub-list-btn').show();
});

    $(document).on('click', '.save-sub-list-btn', function() {
        const row = $(this).closest('tr');
        const subcategoryId = row.data('subcategory-id');
        const updatedData = {
            name: row.find('td:eq(1) input').val(),
            status: row.find('td:eq(5) select').val() === 'true'
        };
        const csrfToken = getCookie('csrftoken');

        $.ajax({
            url: `/update_sub_category/${subcategoryId}/`,
            type: 'POST',
            headers: {
                'X-CSRFToken': csrfToken
            },
            data: {
                'name': updatedData.name,
                'status': updatedData.status
            },
            success: function(response) {
                if (response.success) {
                    row.find('td:eq(1)').text(updatedData.name);
                    row.find('td:eq(5)').text(updatedData.status ? 'Active' : 'Inactive');
                    row.find('.save-sub-list-btn, .cancel-sub-list-btn').hide();
                    row.find('.edit-list-sub-btn, .delete-sub-list-btn').show();
                    alert('Subcategory updated successfully!');
                } else {
                    alert('Error: ' + response.message);
                }
            },
            error: function(xhr, status, error) {
                alert('An error occurred: ' + xhr.responseText);
            }
        });
    });

    $(document).on('click', '.delete-sub-list-btn', function () {
        const row = $(this).closest('tr');
        const subcategoryId = row.data('subcategory-id');

        if (confirm('Are you sure you want to delete this subcategory?')) {
            const csrfToken = getCookie('csrftoken');

            $.ajax({
                url: `/delete_subcategory/${subcategoryId}/`,
                type: 'POST',
                data: {
                    'csrfmiddlewaretoken': csrfToken
                },
                success: function (response) {
                    if (response.success) {
                        alert(response.message);
                        row.remove();
                    } else {
                        alert('Error: ' + response.message);
                    }
                },
                error: function (xhr, status, error) {
                    alert('An error occurred: ' + error);
                }
            });
        }
    });

    // Equipment Content
    function fetchSubCategories() {
        $.ajax({
            url: '/get-sub-categories/',
            type: 'GET',
            success: function(data) {
                var dropdownMenu = $('#subCategoryDropdown');
                dropdownMenu.empty();

                $.each(data, function(index, item) {
                    var listItem = $('<li>', {
                        class: 'dropdown-item',
                        text: item.name,
                        'data-id': item.id,
                        'data-category-name': item.category_name
                    });

                    listItem.on('click', function() {
                        $('#equipmentSubCategory').val($(this).text());
                        $('#equipmentCategory').val($(this).data('category-name'));
                        $('#subCategoryDropdown').hide();
                    });

                    dropdownMenu.append(listItem);
                });

                $('#equipmentSubCategory').on('focus', function() {
                    $('#subCategoryDropdown').show();
                });

                $(document).on('click', function(event) {
                    if (!$(event.target).closest('.dropdown').length) {
                        $('#subCategoryDropdown').hide();
                    }
                });
            },
            error: function(error) {
                console.log("Error fetching sub-categories:", error);
            }
        });
    }

    $('#equipmentSubCategory').on('input', function() {
        var filter = $(this).val().toLowerCase();
        $('#subCategoryDropdown li').each(function() {
            var text = $(this).text().toLowerCase();
            $(this).toggle(text.indexOf(filter) > -1);
        });
    });

     function fetchSubEditCategories() {
        $.ajax({
            url: '/get-sub-categories/',
            type: 'GET',
            success: function(data) {
                var dropdownMenu = $('#subCategoryEditDropdown');
                dropdownMenu.empty();

                $.each(data, function(index, item) {
                    var listItem = $('<li>', {
                        class: 'dropdown-item',
                        text: item.name,
                        'data-id': item.id,
                        'data-category-name': item.category_name
                    });

                    listItem.on('click', function() {
                        $('#equipmentEditSubCategory').val($(this).text());
                        $('#equipmentEditCategory').val($(this).data('category-name'));
                        $('#subCategoryEditDropdown').hide();
                    });

                    dropdownMenu.append(listItem);
                });

                $('#equipmentEditSubCategory').on('focus', function() {
                    $('#subCategoryEditDropdown').show();
                });

                $(document).on('click', function(event) {
                    if (!$(event.target).closest('.dropdown').length) {
                        $('#subCategoryEditDropdown').hide();
                    }
                });
            },
            error: function(error) {
                console.log("Error fetching sub-categories:", error);
            }
        });
    }

    $('#equipmentEditSubCategory').on('input', function() {
    var filter = $(this).val().toLowerCase();
    $('#subCategoryEditDropdown li').each(function() {
        var text = $(this).text().toLowerCase();
        $(this).toggle(text.indexOf(filter) > -1);
    });
});    

    $('.dimension').on('input', function () {
        calculateVolume();
    });

    function calculateVolume() {
        var dimension_h = parseFloat(document.getElementById('dimension_h').value);
        var dimension_w = parseFloat(document.getElementById('dimension_w').value);
        var dimension_l = parseFloat(document.getElementById('dimension_l').value);
        var volumeField = document.getElementById('volume');

        if (!isNaN(dimension_h) && !isNaN(dimension_w) && !isNaN(dimension_l)) {
            var volume = dimension_h * dimension_w * dimension_l;
            volumeField.value = volume;
        } else {
            volumeField.value = '';
        }
    }

    function generateInputColumns(num) {
        var container = document.getElementById('serialNumberInputsContainer');
        container.innerHTML = '';

        for (var i = 0; i < num; i++) {
            var inputDiv = document.createElement('div');
            inputDiv.className = 'row';

            var serialNumberDiv = document.createElement('div');
            serialNumberDiv.className = 'col-xl-6 mb-3';

            var labelSerial = document.createElement('label');
            labelSerial.htmlFor = 'serialNumber' + (i + 1);
            labelSerial.className = 'form-label';
            labelSerial.textContent = 'Serial Number ' + (i + 1);

            var inputSerial = document.createElement('input');
            inputSerial.type = 'text';
            inputSerial.className = 'form-control';
            inputSerial.id = 'serialNumber' + (i + 1);
            inputSerial.name = 'serialNumber' + (i + 1);

            serialNumberDiv.appendChild(labelSerial);
            serialNumberDiv.appendChild(inputSerial);
            inputDiv.appendChild(serialNumberDiv);

            var barcodeDiv = document.createElement('div');
            barcodeDiv.className = 'col-xl-6 mb-3';

            var labelBarcode = document.createElement('label');
            labelBarcode.htmlFor = 'barcode' + (i + 1);
            labelBarcode.className = 'form-label';
            labelBarcode.textContent = 'Barcode Number ' + (i + 1);

            var inputBarcode = document.createElement('input');
            inputBarcode.type = 'text';
            inputBarcode.className = 'form-control';
            inputBarcode.id = 'barcodeNumber' + (i + 1);
            inputBarcode.name = 'barcodeNumber' + (i + 1);

            barcodeDiv.appendChild(labelBarcode);
            barcodeDiv.appendChild(inputBarcode);
            inputDiv.appendChild(barcodeDiv);

            container.appendChild(inputDiv);
        }
    }

    document.getElementById('editUnit').addEventListener('input', function () {
        var num = parseInt(this.value);
        generateInputColumns(num);
    });

    function editgenerateInputColumns(num) {
        var container = document.getElementById('editserialNumberInputsContainer');
        container.innerHTML = '';

        for (var i = 0; i < num; i++) {
            var inputDiv = document.createElement('div');
            inputDiv.className = 'row';

            var serialNumberDiv = document.createElement('div');
            serialNumberDiv.className = 'col-xl-6 mb-3';

            var labelSerial = document.createElement('label');
            labelSerial.htmlFor = 'serialNumber' + (i + 1);
            labelSerial.className = 'form-label';
            labelSerial.textContent = 'Serial Number ' + (i + 1);

            var inputSerial = document.createElement('input');
            inputSerial.type = 'text';
            inputSerial.className = 'form-control';
            inputSerial.id = 'serialNumber' + (i + 1);
            inputSerial.name = 'serialNumber' + (i + 1);

            serialNumberDiv.appendChild(labelSerial);
            serialNumberDiv.appendChild(inputSerial);
            inputDiv.appendChild(serialNumberDiv);

            var barcodeDiv = document.createElement('div');
            barcodeDiv.className = 'col-xl-6 mb-3';

            var labelBarcode = document.createElement('label');
            labelBarcode.htmlFor = 'barcode' + (i + 1);
            labelBarcode.className = 'form-label';
            labelBarcode.textContent = 'Barcode Number ' + (i + 1);

            var inputBarcode = document.createElement('input');
            inputBarcode.type = 'text';
            inputBarcode.className = 'form-control';
            inputBarcode.id = 'barcodeNumber' + (i + 1);
            inputBarcode.name = 'barcodeNumber' + (i + 1);

            barcodeDiv.appendChild(labelBarcode);
            barcodeDiv.appendChild(inputBarcode);
            inputDiv.appendChild(barcodeDiv);

            container.appendChild(inputDiv);
        }
    }

    document.getElementById('unit').addEventListener('input', function () {
        var num = parseInt(this.value);
        editgenerateInputColumns(num);
    });

$("#generalInformationForm").on("submit", function(e) {
    e.preventDefault();

    var formData = new FormData(this);
    var csrftoken = $('meta[name="csrf-token"]').attr('content');

    $.ajax({
        url: '/submit_equipment/',
        type: 'POST',
        headers: { "X-CSRFToken": csrftoken },
        data: formData,
        contentType: false,
        processData: false,
        success: function(response) {
            alert('Data submitted successfully');
            location.reload();
        },
        error: function(xhr, status, error) {
            console.log("Status:", status);
            console.log("Error:", error);
            console.log("Response Text:", xhr.responseText);
            try {
                var response = JSON.parse(xhr.responseText);
                if (response.message === 'Equipment name already exists. Please choose a different name.') {
                    alert('Error: ' + response.message);
                } else {
                    alert('An error occurred: ' + response.message);
                }
            } catch (e) {
                alert('An unknown error occurred.');
            }
        }
    });
});


function loadEquipmentList() {
    $.ajax({
        url: `{% url "fetch_equipment_list" %}`,
        type: 'GET',
        success: function(response) {
            $('#equipment-table-body').empty();

            response.equipment_list.forEach(function(equipment) {
                $('#equipment-table-body').append(`
                    <tr class="editable-equipment-row" data-equipment-id="${equipment.id}">
                        <td>
                            <button class="btn btn-sm btn-primary edit-equipment-btn me-2" data-toggle="tooltip" title="Edit">
                                <i class="fa fa-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-success save-equipment-btn me-2" style="display:none;" data-toggle="tooltip" title="Save">
                                <i class="fa fa-save"></i>
                            </button>
                            <button class="btn btn-sm btn-secondary cancel-equipment-btn me-2" style="display:none;" data-toggle="tooltip" title="Cancel">
                                <i class="fa fa-times"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-equipment-btn me-2" data-toggle="tooltip" title="Delete">
                                <i class="fa fa-trash"></i>
                            </button>
                        </td>

                        <td data-editable="true">${equipment.equipment_name}</td>
                        <td>${equipment.subcategory_name}</td>
                        <td>${equipment.created_by}</td> <!-- Display user name -->
                        <td>${equipment.created_date}</td> <!-- Display only the date -->
                    </tr>
                `);
            });
        },
        error: function(xhr, status, error) {
            console.error('Error loading equipment list:', error);
        }
    });
}


    $(document).on('click', '.delete-equipment-btn', function () {
        const row = $(this).closest('tr');
        const equipmentId = row.data('equipment-id');

        if (confirm('Are you sure you want to delete this equipment?')) {
            const csrfToken = getCookie('csrftoken');

            $.ajax({
                url: `/delete_equipment/${equipmentId}/`,
                type: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken
                },
                success: function (response) {
                    if (response.success) {
                        row.remove();
                    } else {
                        alert('Error: ' + response.message);
                    }
                },
                error: function (xhr, status, error) {
                    alert('An error occurred: ' + error);
                }
            });
        }
    });
$(document).on('click', '.edit-equipment-btn', function() {
    var equipmentId = $(this).closest('tr').data('equipment-id');
    loadStockDetails(equipmentId);

    $.ajax({
        url: `/fetch_equipment_details/`,
        method: 'GET',
        data: { equipmentId: equipmentId },
        success: function(response) {
            if (response.equipment) {
                $('#equipmentEditName').val(response.equipment.equipment_name);
                $('#equipmentEditSubCategory').val(response.equipment.sub_category_name);
                $('#equipmentEditCategory').val(response.equipment.category_type);
                $('#dimensionHeight').val(response.equipment.dimension_height);
                $('#dimensionWidth').val(response.equipment.dimension_width);
                $('#dimensionLength').val(response.equipment.dimension_length);
                $('#volumeEdit').val(response.equipment.volume);
                $('#weightEdit').val(response.equipment.weight);
                $('#hsnNo').val(response.equipment.hsn_no);
                $('#countryOrigin').val(response.equipment.country_origin);

                // Ensure images are displayed correctly
                $('#image1Preview').attr('src', response.attachments.image_1 || '/static/path/to/default_image.png');
                $('#image2Preview').attr('src', response.attachments.image_2 || '/static/path/to/default_image.png');
                $('#image3Preview').attr('src', response.attachments.image_3 || '/static/path/to/default_image.png');

                $('#vendorName').val(response.stock_details.vendor_name);
                $('#purchaseDate').val(response.stock_details.purchase_date);
                $('#unitPrice').val(response.stock_details.unit_price);
                $('#rentalPrice').val(response.stock_details.rental_price);
                $('#referenceNo').val(response.stock_details.reference_no);
                $('#attachmentEdit').val(response.stock_details.attachment);
                $('#quantity').val(response.stock_details.unit);
                $('#serial_no').val(response.stock_details.serial_no);
                $('#barcode_no').val(response.stock_details.barcode_no);

                $('#equipmentIdInput').val(equipmentId);

                // Show the modal
                var myModal = new bootstrap.Modal(document.getElementById('categoryEditModal'));
                myModal.show();
            } else {
                console.error('No equipment data found in response');
            }
        },
        error: function(xhr, status, error) {
            console.error('Error fetching equipment data:', error);
            alert('An error occurred while fetching equipment data. Please try again.');
        }
    });
});

$(document).on('click', '#saveEditStockChanges', function(e) {
    e.preventDefault();

    var formData = new FormData($('#stockEditDetailsForm')[0]);
    var equipmentId = $('#equipmentIdInput').val();
    var csrftoken = $('input[name="csrfmiddlewaretoken"]').val();

    formData.append('equipmentId', equipmentId);

    $.ajax({
        url: '/insert_stock_details/',
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken
        },
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
            if (response.success) {
                alert('Stock details updated successfully.');
                $('#categoryEditModal').modal('hide');
                location.reload();
            } else {
                alert('Failed to update stock details: ' + response.message);
            }
        },
        error: function(xhr, status, error) {
            console.error('Error inserting stock details:', error);
            try {
                var response = JSON.parse(xhr.responseText);
                alert('An error occurred: ' + response.message);
            } catch (e) {
                alert('An unknown error occurred. Please try again.');
            }
        }
    });
});



$("#generalInformationEditForm").submit(function(event) {
    event.preventDefault();

    var formData = new FormData(this);
    var equipmentId = $("#equipmentIdInput").val();

    formData.append("equipmentId", equipmentId);

    $.ajax({
        url: '/update_equipment/',
        type: 'POST',
        data: formData,
        contentType: false,
        processData: false,
        success: function(response) {
            if (response.success) {
                alert("Equipment updated successfully!");
                $('#categoryEditModal').modal('hide');
                location.reload(); // Reload page or update content dynamically
            } else {
                alert("Error updating equipment: " + response.error);
            }
        },
        error: function(xhr, status, error) {
            alert("An error occurred: " + error);
        }
    });
});



    $(window).on('resize', function() {
        adjustModalContent();
    });

    function adjustModalContent() {
        var screenWidth = $(window).width();
        if (screenWidth < 576) {
            $('.modal-lg').removeClass('modal-lg').addClass('modal-sm');
        } else {
            $('.modal-sm').removeClass('modal-sm').addClass('modal-lg');
        }
    }

    adjustModalContent();

    $('#search-input').on('input', function () {
        let searchTerm = $(this).val().toLowerCase();

        $('#master-category-table-body tr').each(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(searchTerm) > -1);
        });

        $('#subcategory-table-body tr').each(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(searchTerm) > -1);
        });

        $('#equipment-table-body tr').each(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(searchTerm) > -1);
        });
    });

    // Function to get CSRF token from cookies
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

let originalStockData = [];
let stockData = [];  // Array to hold the stock data
let currentPage = 1;
let rowsPerPage = 10;
function loadStockDetails(equipmentId) {
    console.log('loadStockDetails function triggered for equipmentId:', equipmentId);
    $.ajax({
        url: `/stock_details_view/${equipmentId}/`,
        method: 'GET',
        success: function (data) {
            if (data.stock_details && data.stock_details.length > 0) {
                originalStockData = data.stock_details.slice();
                stockData = originalStockData.slice();
                displayStockDetails();
                updatePaginationControls();
            } else {
                console.log('No stock details found for equipmentId:', equipmentId);
                $('#stock-details-table-body').empty();
            }
        },
        error: function (xhr, status, error) {
            console.error('Error loading stock details:', error);
        }
    });
}


function displayStockDetails() {
    const startIndex = (currentPage - 1) * rowsPerPage;
    const endIndex = startIndex + rowsPerPage;
    const paginatedData = stockData.slice(startIndex, endIndex);

    $('#stock-details-table-body').empty();
    paginatedData.forEach(function (item) {
        $('#stock-details-table-body').append(`
            <tr data-id="${item.id}">
                <td>${item.vendor_name}</td>
                <td>${item.purchase_date}</td>
                <td>${item.unit_price}</td>
                <td>${item.rental_price}</td>
                <td>${item.serial_no}</td>
                <td>${item.barcode_no}</td>
                <td>
                    <button class="btn btn-sm btn-primary edit-btn">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-success save-btn" style="display: none;">
                        <i class="fas fa-save"></i>
                    </button>
                    <button class="btn btn-sm btn-secondary cancel-btn" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                </td>
            </tr>
        `);
    });

    // Add click event listener to the edit buttons
    $('.edit-btn').on('click', function () {
        const row = $(this).closest('tr');
        enableInlineEditing(row);
    });

    // Add click event listener to the save buttons
    $('.save-btn').on('click', function () {
        const row = $(this).closest('tr');
        saveInlineEditing(row);
    });

    // Add click event listener to the cancel buttons
    $('.cancel-btn').on('click', function () {
        const row = $(this).closest('tr');
        cancelInlineEditing(row);
    });
}

function enableInlineEditing(row) {
    row.find('td').each(function (index, element) {
        if (index < 6) { // Avoid the last column with the buttons
            const cell = $(element);
            const originalText = cell.text();
            cell.html(`<input type="text" class="form-control" value="${originalText}">`);
        }
    });

    row.find('.edit-btn').hide();
    row.find('.save-btn, .cancel-btn').show();
}

function saveInlineEditing(row) {
    // Extract data from the row
    const updatedData = {
        id: row.data('id'),  // Ensure that this id is correctly set in your HTML
        vender_name: row.find('td').eq(0).find('input').val().trim(),
        purchase_date: row.find('td').eq(1).find('input').val().trim(),
        unit_price: row.find('td').eq(2).find('input').val().trim(),
        rental_price: row.find('td').eq(3).find('input').val().trim(),
        serial_no: row.find('td').eq(4).find('input').val().trim(),
        barcode_no: row.find('td').eq(5).find('input').val().trim(),
    };

    console.log('Updated Data being sent:', updatedData);  // Log the data being sent

    // Validate the data before sending to the server
    if (!updatedData.purchase_date) {
        alert('Purchase date cannot be empty.');
        return;
    }

    // Send the updated data to the server via AJAX
    $.ajax({
        url: '/update_stock_details/',
        method: 'POST',
        data: {
            'id': updatedData.id,
            'vender_name': updatedData.vender_name,
            'purchase_date': updatedData.purchase_date,
            'unit_price': updatedData.unit_price,
            'rental_price': updatedData.rental_price,
            'serial_no': updatedData.serial_no,
            'barcode_no': updatedData.barcode_no,
            'csrfmiddlewaretoken': $('meta[name="csrf-token"]').attr('content')  // Include the CSRF token
        },
        success: function (response) {
            console.log('Server response:', response);
            if (response.success) {
                console.log('Data successfully updated:', response);
                row.find('.edit-btn').show();
                row.find('.save-btn, .cancel-btn').hide();
                row.removeClass('editing');
            } else {
                console.error('Error updating data:', response.message);
                alert('Failed to update the data.');
            }
        },
        error: function (xhr, status, error) {
            console.error('AJAX error:', error);
            alert('An error occurred while updating the data.');
        }
    });
}

function cancelInlineEditing(row) {
    row.find('td').each(function (index, element) {
        if (index < 6) { // Avoid the last column with the buttons
            const cell = $(element);
            const input = cell.find('input');
            const originalText = input.attr('value'); // Retrieve the original value from the input's value attribute
            cell.text(originalText);
        }
    });

    row.find('.edit-btn').show();
    row.find('.save-btn, .cancel-btn').hide();
}


function updatePaginationControls() {
    const totalPages = Math.ceil(stockData.length / rowsPerPage);
    $('#currentPage').text(currentPage);
    $('#totalPages').text(totalPages);

    // Enable/Disable buttons based on current page
    $('#prevPage').prop('disabled', currentPage === 1);
    $('#nextPage').prop('disabled', currentPage === totalPages);
}

// Handle auto-search input
$('#stock-search-input').on('input', function () {
    const searchTerm = $(this).val().toLowerCase();
    if (searchTerm) {
        stockData = originalStockData.filter(function (item) {
            return item.vendor_name.toLowerCase().includes(searchTerm) ||
                   item.serial_no.toLowerCase().includes(searchTerm) ||
                   item.barcode_no.toLowerCase().includes(searchTerm) ||
                   item.purchase_date.toLowerCase().includes(searchTerm) ||
                   item.unit_price.toString().includes(searchTerm) ||
                   item.rental_price.toString().includes(searchTerm);
        });
    } else {
        stockData = originalStockData.slice();  // Restore the original data
    }
    currentPage = 1; // Reset to first page
    displayStockDetails();
    updatePaginationControls();
});


// Handle pagination controls
$('#prevPage').on('click', function () {
    if (currentPage > 1) {
        currentPage--;
        displayStockDetails();
        updatePaginationControls();
    }
});

$('#nextPage').on('click', function () {
    const totalPages = Math.ceil(stockData.length / rowsPerPage);
    if (currentPage < totalPages) {
        currentPage++;
        displayStockDetails();
        updatePaginationControls();
    }
});
});

</script>
{% block content %}

    <body data-typography="poppins" data-theme-version="light" data-layout="vertical" data-nav-headerbg="black"
          data-headerbg="color_1">

    <!-- Preloader start -->
    <div id="preloader">
        <div class="lds-ripple">
            <div></div>
            <div></div>
        </div>
    </div>
    <!-- Preloader end -->

    <!-- Main wrapper start -->
    <div id="main-wrapper">
        <!-- Nav header start -->
        {% include 'product_tracking/navheader.html' %}
        <!-- Nav header end -->

        <!-- Header start -->
        {% include 'product_tracking/header.html' %}
        <!-- Header end -->

        <!-- Sidebar start -->
        {% include 'product_tracking/sidebar.html' %}
        <!-- Sidebar end -->

        <!-- Content body start -->
        <div class="content-body">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="card h-auto">
                            <div class="card-body">
                                <ul class="nav nav-tabs custom-tab" id="categoryTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                        <a class="nav-link active" id="equipment-tab" data-bs-toggle="tab"
                                           href="#equipment" role="tab" aria-controls="equipment"
                                           aria-selected="true">Equipment Details</a>
                                    </li>

                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link" id="subcategory-tab" data-bs-toggle="tab"
                                           href="#subcategory" role="tab" aria-controls="subcategory"
                                           aria-selected="false">Subcategory</a>
                                    </li>
                                     <li class="nav-item" role="presentation">
                                        <a class="nav-link" id="master-category-tab" data-bs-toggle="tab"
                                           href="#master-category" role="tab" aria-controls="master-category"
                                           aria-selected="false">Master Category</a>
                                    </li>

                                </ul>

                                <!-- Search bar -->
                                <div class="row my-3">
                                    <div class="col-md-6">
                                        <input type="text" id="search-input" class="form-control"
                                               placeholder="Search...">
                                    </div>
                                </div>

                                <div class="tab-content p-3 border border-top-0 rounded-bottom"
                                     id="categoryTabContent">
                                    <!-- Master Category Tab Content -->
                                    <div class="tab-pane fade" id="master-category" role="tabpanel"
                                         aria-labelledby="master-category-tab">
                                        <div class="table-responsive">
                                            <table class="table table-bordered table-responsive-sm">
                                                <thead>
                                                <tr>
                                                    <th><span class="plus-icon" id="addMasterCategoryRow">+</span></th>
                                                    <th>Master Category</th>
                                                    <th>Created By</th>
                                                    <th>Created Date</th>
                                                    <th>Status</th>
                                                </tr>
                                                </thead>
                                                <tbody id="master-category-table-body">
                                                <!-- Master Category rows will be appended here by JavaScript -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Subcategory Tab Content -->
                                    <div class="tab-pane fade" id="subcategory" role="tabpanel"
                                         aria-labelledby="subcategory-tab">
                                        <div class="table-responsive">
                                            <table class="table table-bordered table-responsive-sm">
                                                <thead>
                                                <tr>
                                                    <th><span class="plus-icon" id="addSubcategoryRow">+</span></th>
                                                    <th>Sub Category</th>
                                                    <th>Category</th>
                                                    <th>Created By</th>
                                                    <th>Created Date</th>
                                                    <th>Status</th>
                                                </tr>
                                                </thead>
                                                <tbody id="subcategory-table-body">
                                                <!-- Subcategory rows will be appended here by JavaScript -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>


                                    <!-- Equipment Tab Content -->
                                    <div class="tab-pane fade show active" id="equipment" role="tabpanel"
                                         aria-labelledby="equipment-tab">
                                        <div class="table-responsive">
                                            <table class="table table-bordered table-responsive-sm">
                                                <thead>
                                                <tr>
                                                    <th><span class="plus-icon" id="addEquipmentRow">+</span></th>

                                                    <th>Name</th>
                                                    <th>Subcategory</th>
                                                    <th>Created By</th>
                                                    <th>Created Date</th>

                                                </tr>
                                                </thead>
                                                <tbody id="equipment-table-body">
                                                <!-- Equipment rows will be appended here by JavaScript -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> <!-- End of outer column -->
                </div> <!-- End of outer row -->
            </div>

        </div>


<div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md"> <!-- Use modal-lg for a larger modal -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="categoryModalLabel">Add Equipment and Stock Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs custom-tab" id="equipmentTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a class="nav-link active" id="general-information-tab" data-bs-toggle="tab"
                           href="#general-information" role="tab" aria-controls="general-information"
                           aria-selected="true">Equipment Details</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="stock-details" data-bs-toggle="tab"
                           href="#stockdetails" role="tab" aria-controls="stock-details"
                           aria-selected="false">Stock Details</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="general-information" role="tabpanel" aria-labelledby="general-information-tab">

    <!-- Equipment Details Form -->
    <form id="generalInformationForm" method="POST" enctype="multipart/form-data">
    <!-- Grouped Form Elements in a Single Row -->
    <div class="row custom-margin">
        <!-- Input Box -->
        <div class="col-xl-4 col-lg-4 col-md-6 mb-3">
            <label for="equipmentName" class="form-label">Equipment Name</label>
            <input type="text" class="form-control" id="equipmentName" name="equipmentName">
        </div>

        <!-- First Dropdown -->
        <div class="col-xl-4 col-lg-4 col-md-6 mb-3">
            <div class="dropdown">
                <label for="equipmentSubCategory" class="form-label">Sub Category</label>
                <input type="text" class="form-control dropdown-toggle" id="equipmentSubCategory"
                       data-bs-toggle="dropdown" aria-expanded="false"
                       placeholder="Select Sub Category" autocomplete="off" name="equipmentSubCategory">
                <ul class="dropdown-menu" id="subCategoryDropdown" aria-labelledby="equipmentSubCategory">
                    <!-- Dynamic options will be appended here -->
                </ul>
            </div>
        </div>
        <div class="col-xl-4 col-lg-4 col-md-6 mb-3">
            <label for="equipmentCategory" class="form-label">Category</label>
            <input type="text" class="form-control" id="equipmentCategory" name="equipmentCategory" readonly>
        </div>

        <!-- Other input fields for dimensions, weight, etc. -->
        <div class="row custom-margin">
            <div class="col-xl-3 mb-3">
                <label class="form-label" style="font-size: 11px;">Dimension(Height - Inch)</label>
                <input type="number" class="form-control dimension" id="dimension_h" name="dimension_h" placeholder="">
            </div>
            <div class="col-xl-3 mb-3">
                <label class="form-label" style="font-size: 11px;">Dimension(Width - Inch)</label>
                <input type="number" class="form-control dimension" id="dimension_w" name="dimension_w" placeholder="">
            </div>
            <div class="col-xl-3 mb-3">
                <label class="form-label" style="font-size: 11px;">Dimension(Length - Inch)</label>
                <input type="number" class="form-control dimension" id="dimension_l" name="dimension_l" placeholder="">
            </div>
            <div class="col-xl-3 mb-3">
                <label class="form-label">Volume</label>
                <input type="number" class="form-control" id="volume" name="volume" placeholder="" readonly>
            </div>
            <div class="col-xl-3 mb-3">
                <label for="weight" class="form-label">Weight</label>
                <input type="number" class="form-control" id="weight" name="weight" placeholder="">
            </div>
            <div class="col-xl-3 mb-3">
                <label for="hsn_no" class="form-label">HSN NO<span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="hsn_no" name="hsn_no" required>
            </div>
            <div class="col-xl-3 mb-3">
                <label for="country_origin" class="form-label">Country of Origin</label>
                <input type="text" class="form-control" id="country_origin" name="country_origin" placeholder="">
            </div>
        </div>

        <!-- Attachments Section -->
     <div id="attachments" class="col-xl-12 mb-3 custom-margin" style="margin-top: 18px;">
    <div class="row">
        <div class="col-md-4 mb-3">
            <label for="image1">Image 1:</label>
            <div class="input-group">
                <input type="file" id="image1" name="image1" accept=".jpg, .jpeg, .png">
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <label for="image2">Image 2:</label>
            <div class="input-group">
                <input type="file" id="image2" name="image2" accept=".jpg, .jpeg, .png">
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <label for="image3">Image 3:</label>
            <div class="input-group">
                <input type="file" id="image3" name="image3" accept=".jpg, .jpeg, .png">
            </div>
        </div>
    </div>
</div>

    </div>

    <!-- Buttons Section -->
    <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-secondary me-2" id="closeFormBtn" data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" id="saveChanges">Submit</button>
    </div>
</form>


</div>

<!-- Stock Details Section -->

<div class="tab-pane fade" id="stockdetails" role="tabpanel" aria-labelledby="stock-details">
    <!-- Stock Details Form -->
    <form id="stockDetailsForm" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row custom-margin">
            <input type="hidden" id="equipmentIdInput" name="equipmentId">

            <div class="col-xl-4 mb-3">
                <label for="vendor_name">Vendor Name<span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="vendor_name" name="vendor_name" required>
            </div>
            <div class="col-xl-4 mb-3">
                <label for="purchase_date" class="form-label">Purchase Date<span class="text-danger">*</span></label>
                <input type="date" class="form-control" id="purchase_date" name="purchase_date" required>
            </div>
            <div class="col-xl-4 mb-3">
                <label for="unit_price" class="form-label">Unit Price<span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="unit_price" name="unit_price" required>
            </div>
            <div class="col-xl-4 mb-3">
                <label for="rental_price" class="form-label">Rental Price<span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="rental_price" name="rental_price" required>
            </div>
            <div class="col-xl-4 mb-3">
                <label for="reference_no" class="form-label">Reference No<span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="reference_no" name="reference_no" required>
            </div>
            <div class="col-xl-4 mb-3">
                <label for="attachment" class="form-label">Attachment</label>
                <input type="file" name="attachment" id="attachment" accept=".pdf">
                <div id="attachmentError" class="text-danger" style="display: none;"></div>
            </div>
            <div class="col-xl-4 mb-3">
                <label for="editUnit" class="form-label">Unit</label>
                <input type="text" class="form-control" id="editUnit" name="unitValue" required>
            </div>
            <div id="serialNumberInputsContainer">
                <!-- Serial Number input boxes will be dynamically generated here -->
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="closeStockFormBtn">Close</button>
            <button type="submit" class="btn btn-primary" id="saveStockChanges">Submit</button>
        </div>
    </form>

</div>

                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="categoryEditModal" tabindex="-1" aria-labelledby="categoryEditModalLabel" aria-hidden="true">
    <div class="modal-dialog custom-modal-width">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="categoryEditModalLabel">Edit Equipment and Stock Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs custom-tab" id="equipmentEditTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a class="nav-link active" id="general-edit-information-tab" data-bs-toggle="tab"
                           href="#general-edit-information" role="tab" aria-controls="general-information"
                           aria-selected="true">Equipment Details</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="stock-edit-details" data-bs-toggle="tab"
                           href="#stockeditdetails" role="tab" aria-controls="stock-edit-details"
                           aria-selected="false">Stock IN</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="stock-tab" data-bs-toggle="tab"
                           href="#stock" role="tab" aria-controls="stock"
                           aria-selected="false">Stock Details</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <!-- Equipment Details Form -->
                    <div class="tab-pane fade show active" id="general-edit-information" role="tabpanel" aria-labelledby="general-edit-information-tab">
                        <form id="generalInformationEditForm" enctype="multipart/form-data">
                        {% csrf_token %}
                            <div class="row custom-margin">
                                <!-- Input Box -->
                                <div class="col-xl-4 col-lg-4 col-md-6 mb-3">
                                    <label for="equipmentName" class="form-label">Equipment Name</label>
                                    <input type="text" class="form-control" id="equipmentEditName" name="equipmentName">
                                </div>
                                <!-- First Dropdown -->
                                <div class="col-xl-4 col-lg-4 col-md-6 mb-3">
                                    <div class="dropdown">
                                        <label for="equipmentEditSubCategory" class="form-label">Sub Category</label>
                                        <input type="text" class="form-control dropdown-toggle" id="equipmentEditSubCategory"
                                               data-bs-toggle="dropdown" aria-expanded="false"
                                               placeholder="Select Sub Category" autocomplete="off" name="subCategoryName">
                                        <ul class="dropdown-menu" id="subCategoryEditDropdown" aria-labelledby="equipmentEditSubCategory">
                                            <!-- Dynamic options will be appended here -->
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-xl-4 col-lg-4 col-md-6 mb-3">
                                    <label for="equipmentCategory" class="form-label">Category</label>
                                    <input type="text" class="form-control" id="equipmentEditCategory" name="categoryType" readonly>
                                </div>
                                <!-- Other input fields -->
                                <div class="row custom-margin">
                                    <div class="col-xl-3 mb-3">
                                        <label class="form-label" style="font-size: 11px;">Dimension(Height - Inch)</label>
                                        <input type="number" class="form-control" id="dimensionHeight" name="dimension_h">
                                    </div>
                                    <div class="col-xl-3 mb-3">
                                        <label class="form-label" style="font-size: 11px;">Dimension(Width - Inch)</label>
                                        <input type="number" class="form-control" id="dimensionWidth" name="dimension_w">
                                    </div>
                                    <div class="col-xl-3 mb-3">
                                        <label class="form-label" style="font-size: 11px;">Dimension(Length - Inch)</label>
                                        <input type="number" class="form-control" id="dimensionLength" name="dimension_l">
                                    </div>
                                    <div class="col-xl-3 mb-3">
                                        <label class="form-label">Volume</label>
                                        <input type="number" class="form-control" id="volumeEdit" name="volume" readonly>
                                    </div>
                                    <div class="col-xl-3 mb-3">
                                        <label for="weight" class="form-label">Weight</label>
                                        <input type="number" class="form-control" id="weightEdit" name="weight">
                                    </div>
                                    <div class="col-xl-3 mb-3">
                                        <label for="hsn_no" class="form-label">HSN NO<span class="text-danger">*</span></label>
                                        <input type="number" class="form-control" id="hsnNo" name="hsn_no" required>
                                    </div>
                                    <div class="col-xl-3 mb-3">
                                        <label for="country_origin" class="form-label">Country of Origin</label>
                                        <input type="text" class="form-control" id="countryOrigin" name="country_origin">
                                    </div>
                                </div>
                                <!-- Attachments Section -->
                                <div id="attachments" class="col-xl-12 mb-3 custom-margin" style="margin-top: 18px;">
                                    <label>Attachments:</label>
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="image1Preview">Image 1:</label>
                                            <div class="input-group">
                                                <input type="file" id="image1" name="image1[]" accept=".jpg, .jpeg, .png">
                                            </div>
                                            <img id="image1Preview" src="default_image.png" alt="Image 1 Preview" class="img-fluid">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="image2Preview">Image 2:</label>
                                            <div class="input-group">
                                                <input type="file" id="image2" name="image2[]" accept=".jpg, .jpeg, .png">
                                            </div>
                                            <img id="image2Preview" src="default_image.png" alt="Image 2 Preview" class="img-fluid">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="image3Preview">Image 3:</label>
                                            <div class="input-group">
                                                <input type="file" id="image3" name="image3[]" accept=".jpg, .jpeg, .png">
                                            </div>
                                            <img id="image3Preview" src="default_image.png" alt="Image 3 Preview" class="img-fluid">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn btn-secondary me-2" id="closeEditEquipmentFormBtn" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary" id="saveEditEquipmentChanges">Submit</button>
                            </div>
                        </form>
                    </div>
                    <!-- Stock IN Section -->
                    <div class="tab-pane fade" id="stockeditdetails" role="tabpanel" aria-labelledby="stock-edit-details">
                        <form id="stockEditDetailsForm" enctype="multipart/form-data">
                            <div class="row custom-margin">
                                <input type="hidden" id="equipmentIdInput" name="equipmentId">
                                <div class="col-xl-4 mb-3">
                                    <label for="editVendorName">Vendor Name<span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="editVendorName" name="edit_vendor_name" required>
                                </div>
                                <div class="col-xl-4 mb-3">
                                    <label for="editPurchaseDate" class="form-label">Purchase Date<span class="text-danger">*</span></label>
                                    <input type="date" class="form-control" id="editPurchaseDate" name="purchase_date" required>
                                </div>
                                <div class="col-xl-4 mb-3">
                                    <label for="editUnitPrice" class="form-label">Unit Price<span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="editUnitPrice" name="unit_price" required>
                                </div>
                                <div class="col-xl-4 mb-3">
                                    <label for="EditRentalPrice" class="form-label">Rental Price<span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="EditRentalPrice" name="rental_price" required>
                                </div>
                                <div class="col-xl-4 mb-3">
                                    <label for="EditReferenceNo" class="form-label">Reference No<span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="EditReferenceNo" name="reference_no" required>
                                </div>
                                <div class="col-xl-4 mb-3">
                                    <label for="editAttachment" class="form-label">Attachment</label>
                                    <input type="file" name="attachment" id="editAttachment" accept=".pdf">
                                    <div id="attachmentError" class="text-danger" style="display: none;"></div>
                                </div>
                                <div class="col-xl-4 mb-3">
                                    <label for="unit" class="form-label">Unit</label>
                                    <input type="text" class="form-control" id="unit" name="editUnit" required>
                                </div>
                                <div id="editserialNumberInputsContainer">
                                    <!-- Serial Number input boxes will be dynamically generated here -->
                                </div>
                                <div id="stockDetailsContainer">
                                    <!-- Previous Values for the Serial Number and Barcode Number input boxes will be generated here -->
                                </div>
                            </div>
                            <!-- Buttons Section -->
                            <div class="d-flex justify-content-end modal-footer">
                                <button type="button" class="btn btn-secondary me-2" id="closeStockFormBtn" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary" id="saveEditStockChanges">Submit</button>
                            </div>
                        </form>

                    </div>
                    <!-- Stock Details1 Section -->
                        <div class="tab-pane fade" id="stock" role="tabpanel" aria-labelledby="stock">
                              <div class="row my-3">
                                <div class="col-md-6">
                                    <input type="text" id="stock-search-input" class="form-control"
                                           placeholder="Search stock details...">
                                </div>
                            </div>
                             <div class="table-responsive mt-4">
                                                <table class="table table-striped table-hover table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th>Vendor Name</th>
                                                            <th>Purchase Date</th>
                                                            <th>Unit Price</th>
                                                            <th>Rental Price</th>
                                                            <th>Serial Number</th>
                                                            <th>Barcode Number</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="stock-details-table-body">
                                                        <!-- Rows will be appended here by JavaScript -->
                                                    </tbody>
                                                </table>
                        </div>

                          <div class="d-flex justify-content-between">
                            <button id="prevPage" class="btn btn-primary">Previous</button>
                            <span>Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
                            <button id="nextPage" class="btn btn-primary">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


        <!-- Content body end -->

        <!-- Footer start -->

        {% include 'product_tracking/footer.html' %}
        <!-- Footer end -->
    </div>
    <!-- Main wrapper end -->
 <meta name="csrf-token" content="{{ csrf_token }}">



    </body>
{% endblock %}
