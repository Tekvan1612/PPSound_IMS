{% include 'product_tracking/head.html' %}
{% load static %}
{% block content %}
    <style>
        .header-row {
            background-color: red;
            color: blue;
        }

        .employee-details {
            display: none;
            margin-top: 10px;
        }

        .employee-details th {
            text-align: left;
        }

        .modal-dialog modal-lg-custom {
            max-width: 55%; /* Adjust the percentage to increase or decrease the width */
        }


        .employee-name {
            color: #0D99FF;
            text-decoration: underline;
            cursor: pointer;
        }

        /* Container for attachments */
        .attachments-container {
            display: flex;
            flex-wrap: wrap;
        }

        /* Thumbnail styling */
        .attachments-container img {
            border: 2px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin: 5px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .attachments-container img:hover {
            transform: scale(1.05);
        }

        /* Lightbox styling */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .lightbox-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
        }

        #caption {
            margin: 10px;
            text-align: center;
            color: #fff;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 25px;
            color: #fff;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
        }

        .modal {
            z-index: 1050;
        }

    </style>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!--     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mobileInput = document.getElementById('exampleFormControlInput88');

            mobileInput.addEventListener('input', function () {
                // Remove non-digit characters and limit to 10 digits
                const value = this.value.replace(/\D/g, '').slice(0, 10);
                this.value = value;
            });

            mobileInput.addEventListener('blur', function () {
                if (this.value.length !== 10) {
                    alert('Mobile number must be exactly 10 digits long.');
                    this.focus();
                }
            });
        });

        $(document).ready(function () {
            let currentPage = 1;
            const pageSize = 10;
            let removedAttachments = [];
            let removedProfilePic = false;

            // Crew Designation Listing dropdown
            $.ajax({
            url: "/get_crew_designations/",
            type: "GET",
            success: function (response) {
                var dropdown = $("#exampleFormControlInput4");
                dropdown.empty(); // clear previous options
                dropdown.append('<option value="">Select Designation</option>');

                $.each(response.designations, function (index, designation) {
                    dropdown.append('<option value="' + designation + '">' + designation + '</option>');
                });
            },
            error: function (xhr, status, error) {
                console.error("Failed to fetch designations:", error);
            }
        });

            // Crew Designation Listing dropdown for edit
            $.ajax({
    url: "/get_crew_designations/",
    type: "GET",
    success: function (response) {
        var dropdown = $("#editEmployeeDesignation");
        dropdown.empty();
        dropdown.append('<option value="">Select Designation</option>');

        $.each(response.designations, function (index, designation) {
            dropdown.append('<option value="' + designation + '">' + designation + '</option>');
        });
    },
    error: function (xhr, status, error) {
        console.error("Failed to fetch designations:", error);
    }
});


            $('#exampleFormControlInputfour').select2({
                placeholder: 'Select employee',
                allowClear: true,
                ajax: {
                    url: '/employee_dropdown/',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            query: params.term || ''  // Send search term to server, if any
                        };
                    },
                    processResults: function (data) {
                        return {
                            results: data.employees.map(function (employee) {
                                return {
                                    id: employee.id,
                                    text: employee.name  // Correctly map name to text
                                };
                            })
                        };
                    },
                    cache: true
                },
                minimumInputLength: 0  // Set to 0 to fetch all employees on dropdown open
            });

            function fetchEmployeeDropdown(selector, selectedEmployee = null) {
                $(selector).select2({
                    placeholder: 'Select employee',
                    allowClear: true,
                    ajax: {
                        url: '/employee_dropdown/',
                        dataType: 'json',
                        delay: 250,
                        data: function (params) {
                            return {
                                query: params.term || ''  // Send search term to server
                            };
                        },
                        processResults: function (data) {
                            return {
                                results: data.employees.map(function (employee) {
                                    return {
                                        id: employee.id,
                                        text: employee.name
                                    };
                                })
                            };
                        },
                        cache: true
                    },
                    minimumInputLength: 0
                });

                // Set selected employee if provided (when editing)
                if (selectedEmployee) {
                    const option = new Option(selectedEmployee.name, selectedEmployee.id, true, true);
                    $(selector).append(option).trigger('change');
                }
            }

            $('#offcanvasExample').on('shown.bs.offcanvas', function () {
                fetchEmployeeDropdown('#exampleFormControlInputfour');
            });

            $('#addEmployeeBtn').on('click', function () {
                fetchEmployeeDropdown('#exampleFormControlInputfour');
            });

            function showEmployeeDetails(employee) {
                console.log('Populating Employee Modal', employee);

                // Update the modal fields with the employee data
                $('#modal_employee_id').text(employee.employee_id || 'N/A');
                $('#modal_name').text(employee.name || 'N/A');
                $('#modal_designation').text(employee.designation || 'N/A');
                $('#modal_joining_date').text(employee.joining_date || 'N/A');
                $('#modal_dob').text(employee.dob || 'N/A');
                $('#modal_blood_group').text(employee.blood_group || 'N/A');
                $('#modal_reporting').text(employee.reporting || 'N/A');
                $('#modal_p_address').text(employee.p_address || 'N/A');
                $('#modal_c_address').text(employee.c_address || 'N/A');
                $('#modal_country').text(employee.country || 'N/A');
                $('#modal_state').text(employee.state || 'N/A');
                $('#modal_status').text(employee.status ? 'Active' : 'Inactive');

                // Update profile picture
                const profilePic = employee.profile_pic || '/path/to/default/profile/image.png';
                $('#employeeProfilePic').attr('src', profilePic);

                // Handle attachments
                let attachmentsHtml = '';
                if (employee.attachments && employee.attachments.length > 0) {
                    employee.attachments.forEach((attachment, index) => {
                        attachmentsHtml += `
                    <div style="margin: 10px; display: inline-block;">
                        <img src="${attachment}" alt="Attachment ${index + 1}" width="100" height="100" style="margin-right: 10px; max-height: 200px;" class="attachment-thumbnail img-thumbnail">
                    </div>`;
                    });
                } else {
                    attachmentsHtml = '<p>No attachments available</p>';
                }
                $('#modal_attachments_container').html(attachmentsHtml);

                // Lightbox functionality for attachments
                const lightbox = $('#lightbox');
                const lightboxImg = $('#lightbox-img');
                const captionText = $('#caption');

                $(document).on('click', '.attachment-thumbnail', function () {
                    lightbox.show();
                    lightboxImg.attr('src', $(this).attr('src'));
                    captionText.text($(this).attr('alt'));
                });

                $('.close').on('click', function () {
                    lightbox.hide();
                });

                // Finally, show the modal
                $('#employeeDetailsModal').modal('show');
            }

            // Fetch employee data from the list
            $(document).on('click', '.employee-name', function (event) {
                event.preventDefault();
                const employee = $(this).data('employee');
                console.log('Selected employee:', employee);
                showEmployeeDetails(employee);  // Show the details in the modal
            });
            // Fetch employee data from the list
            $(document).on('click', '.employee-name', function (event) {
                event.preventDefault();
                const employee = $(this).data('employee');
                console.log('Selected employee:', employee);
                showEmployeeDetails(employee);  // Show the details in the modal
            });

            function fetchEmployeeList(page) {
                $.ajax({
                    url: '/employee_list/',
                    type: 'GET',
                    data: {
                        page: page,
                        page_size: pageSize
                    },
                    success: function (response) {
                        $('#employee-table-body').empty();
                        if (response.data && response.data.length > 0) {
                            $.each(response.data, function (index, employee) {
                                console.log('Employee data:', employee); // Print employee data inside the table generation loop

                                var row = `<tr>
                        <td>${(page - 1) * pageSize + (index + 1)}</td>
                        <td style="display: none;">${employee.id}</td>
                        <td><img src="${employee.profile_pic}" alt="Employee Image" width="50"></td>
                        <td>${employee.employee_id}</td>
                        <td><a href="#" class="employee-name" data-employee='${JSON.stringify(employee)}'>${employee.name}</a></td>
                        <td>${employee.email}</td>
                        <td>${employee.mobile_no}</td>
                        <td>${employee.created_by}</td>
                        <td>${employee.created_date}</td>
                        <td>
                            <button class="btn btn-sm btn-primary edit-btn me-2" data-id="${employee.id}" data-employee='${JSON.stringify(employee)}'><i class="fa fa-pencil"></i></button>
                            <button class="btn btn-sm btn-danger delete-btn" data-id="${employee.id}"><i class="fa fa-trash"></i></button>
                        </td>
                    </tr>`;
                                $('#employee-table-body').append(row);
                            });


                            updatePaginationControls(response.total_items, response.current_page, response.total_pages);
                        } else {
                            $('#employee-table-body').append('<tr><td colspan="10">No records found</td></tr>');
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching employee data:', error);
                        $('#employee-table-body').append('<tr><td colspan="10">Error fetching employee data</td></tr>');
                    }
                });
            }

            function updatePaginationControls(totalItems, currentPage, totalPages) {
                $('#pagination-controls').html('');

                if (currentPage > 1) {
                    $('#pagination-controls').append('<button id="prev-page-btn" class="btn btn-primary">Previous</button>');
                }

                if (currentPage < totalPages) {
                    $('#pagination-controls').append('<button id="next-page-btn" class="btn btn-primary">Next</button>');
                }

                const startItem = (currentPage - 1) * pageSize + 1;
                const endItem = Math.min(currentPage * pageSize, totalItems);

                $('#pagination-count').text(`Showing ${startItem} to ${endItem} of ${totalItems} entries`);
            }

            $(document).on('click', '#prev-page-btn', function () {
                if (currentPage > 1) {
                    currentPage--;
                    fetchEmployeeList(currentPage);
                }
            });

            $(document).on('click', '#next-page-btn', function () {
                currentPage++;
                fetchEmployeeList(currentPage);
            });

            fetchEmployeeList(currentPage);


            $(document).on('click', '.edit-btn', function () {
                var employee = $(this).data('employee');
                console.log('Editing employee:', employee);

                // Fill modal fields with employee data
                $('#editEmployeeIdHidden').val(employee.id);
                $('#editEmployeeId').val(employee.employee_id);
                $('#editEmployeeName').val(employee.name);
                $('#editEmployeeEmail').val(employee.email);
                $('#editEmployeeMobile').val(employee.mobile_no);
                $('#editEmployeeDesignation').val(employee.designation);
                $('#editEmployeeGender').val(employee.gender);
                $('#editEmployeeJoiningDate').val(employee.joining_date);
                $('#editEmployeeDOB').val(employee.dob);
                $('#editEmployeePAddress').val(employee.p_address);
                $('#editEmployeeCAddress').val(employee.c_address);
                $('#editEmployeeCountry').val(employee.country);
                $('#editEmployeeState').val(employee.state);
                $('#editEmployeeStatus').val(employee.status ? 'true' : 'false');
                $('#editBloodGroup').val(employee.blood_group);

                // Fetch and populate the reporting dropdown with the existing value
                console.log('Fetch the Employee Reporting Name:', employee.reporting);
                fetchEmployeeDropdown('#editEmployeeReporting', {id: employee.reporting_id, name: employee.reporting});

                // Log all modal fields to check their values
                console.log('Modal field values:');
                console.log('ID:', $('#editEmployeeIdHidden').val());
                console.log('Employee ID:', $('#editEmployeeId').val());
                console.log('Name:', $('#editEmployeeName').val());
                console.log('Email:', $('#editEmployeeEmail').val());
                console.log('Mobile:', $('#editEmployeeMobile').val());
                console.log('Designation:', $('#editEmployeeDesignation').val());
                console.log('Gender:', $('#editEmployeeGender').val());
                console.log('Joining Date:', $('#editEmployeeJoiningDate').val());
                console.log('DOB:', $('#editEmployeeDOB').val());
                console.log('Permanent Address:', $('#editEmployeePAddress').val());
                console.log('Current Address:', $('#editEmployeeCAddress').val());
                console.log('Country:', $('#editEmployeeCountry').val());
                console.log('State:', $('#editEmployeeState').val());
                console.log('Status:', $('#editEmployeeStatus').val());
                console.log('Blood Group:', $('#editBloodGroup').val());
                console.log('Reporting:', $('#editEmployeeReporting').val());

                removedAttachments = [];
                removedProfilePic = false;

                // Handle attachments
                $('#attachment-list').empty();
                if (employee.attachments && employee.attachments.length > 0) {
                    $('#attachment-list').append(`
            <div class="mt-2">
                <label>Existing Attachments:</label>
                <ul>
                    ${employee.attachments.map((att, index) => `<li>${att.split('/').pop()} <button class="btn btn-sm btn-danger remove-attachment" data-attachment-id="${employee.attachments[index]}"><i class="fa fa-times"></i></button></li>`).join('')}
                </ul>
            </div>
        `);
                }

                // Handle profile picture
                $('#profilePicPreview').empty();
                if (employee.profile_pic) {
                    $('#profilePicPreview').append(`<img src="${employee.profile_pic}" alt="Profile Picture" width="100" height="100"><button type="button" class="btn btn-sm btn-danger remove-profile-pic mt-2">Remove</button>`);
                }

                // Show the modal
                $('#editEmployeeModal').modal('show');
            });


            console.log($('#editEmployeeModal').length);


            $(document).on('click', '.remove-profile-pic', function () {
                if (confirm('Are you sure you want to remove the profile picture?')) {
                    $('#profilePicPreview').empty();
                    removedProfilePic = true;
                }
            });

            $('#saveChangesBtn').on('click', function () {
                const formData = new FormData($('#editEmployeeForm')[0]);
                formData.append('operation', 'update');

                formData.append('removed_attachments', JSON.stringify(removedAttachments));
                formData.append('removed_profile_pic', removedProfilePic);

                console.log('Form data before edit:', formData);


                $.ajax({
                    url: '/modify_employee/',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        alert(response.success);
                        $('#editEmployeeModal').modal('hide');
                        fetchEmployeeList(currentPage);
                    },
                    error: function (xhr) {
                        const response = JSON.parse(xhr.responseText);
                        alert(response.error);
                    }
                });
            });

            $('#closeFormBtn').on('click', function () {
                $('#editEmployeeModal').modal('hide');
            });

            $('#cancel-button').on('click', function (e) {
                e.preventDefault();
                $('#offcanvasExample').removeClass('show');
                $('body').removeClass('offcanvas-open');
                $('.offcanvas-backdrop').remove();
            });

            $(document).on('click', '.delete-btn', function () {
                const employeeId = $(this).data('id');
                if (confirm('Are you sure you want to delete this employee?')) {
                    $.ajax({
                        url: '/modify_employee/',
                        type: 'POST',
                        data: {
                            'operation': 'delete',
                            'id': employeeId,
                            'csrfmiddlewaretoken': getCookie('csrftoken')
                        },
                        success: function (response) {
                            alert(response.success);
                            fetchEmployeeList(currentPage);
                        },
                        error: function (xhr) {
                            alert('Error deleting employee');
                        }
                    });
                }
            });

            $(document).on('click', '.remove-attachment', function () {
                const attachmentId = $(this).data('attachment-id');
                const removeButton = $(this);
                if (confirm('Are you sure you want to delete this attachment?')) {
                    removedAttachments.push(attachmentId);
                    removeButton.closest('li').remove();
                }
            });

            $('#closeDetailsBtn').on('click', function () {
                $('#employeeDetailsModal').modal('hide');
            });

            $('#employee-form').on('submit', function (event) {
                event.preventDefault();
                const formData = new FormData(this);

                $.ajax({
                    url: '/add_employee/',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        alert('Employee added successfully');
                        $('#offcanvasExample').offcanvas('hide');
                        location.reload();
                        fetchEmployeeList(currentPage);
                    },
                    error: function (xhr) {
                        const response = JSON.parse(xhr.responseText);
                        alert(response.error);
                    }
                });
            });

            $(document).on('click', '.employee-name', function (event) {
                event.preventDefault();
                var employee = $(this).data('employee');

                console.log('Selected employee data:', employee);

                // Other employee details (like name, profile pic, etc.) are populated here...

                // Profile picture
                if (employee.profile_pic) {
                    $('#employeeProfilePic').attr('src', employee.profile_pic);
                } else {
                    $('#employeeProfilePic').attr('src', 'path/to/default/profile/image.png'); // Add a default profile image if none
                }

                // Attachments Preview
                var attachmentsHtml = '';
                if (employee.attachments && employee.attachments.length > 0) {
                    $.each(employee.attachments, function (index, attachment) {
                        if (attachment.startsWith('/media/https://')) {
                            attachment = attachment.replace('/media/', '');
                        }
                        // Ensure that each attachment URL is properly set
                        attachmentsHtml += `
                <div style="margin: 10px; display: inline-block;">
                    <img src="${attachment}" alt="Attachment ${index + 1}" width="100" height="100" style="margin-right: 10px; max-height: 200px;" class="attachment-thumbnail img-thumbnail">
                </div>`;
                    });
                } else {
                    attachmentsHtml = '<p>No attachments available</p>';
                }
                $('#modal_attachments_container').html(attachmentsHtml);

                // Lightbox functionality
                var lightbox = $('#lightbox');
                var lightboxImg = $('#lightbox-img');
                var captionText = $('#caption');

                $(document).on('click', '.attachment-thumbnail', function () {
                    lightbox.show();
                    lightboxImg.attr('src', $(this).attr('src'));
                    captionText.text($(this).attr('alt'));
                });

                $('.close').on('click', function () {
                    lightbox.hide();
                });

                // Show the modal
                $('#employeeDetailsModal').modal('show');
            });

            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        });

    </script>

    <body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="lds-ripple">
            <div></div>
            <div></div>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">
        <!--**********************************
            Nav header start
        ***********************************-->
        {% include 'product_tracking/navheader.html' %}
        <!--**********************************

            Header start
        ***********************************-->
        {% include 'product_tracking/header.html' %}
        <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

        <!--**********************************
            Sidebar start
        ***********************************-->
        {% include 'product_tracking/sidebar.html' %}

        <!--**********************************
            Sidebar end
        ***********************************-->

        <!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body">
            <!-- row -->
            <div class="page-titles">
                <ol class="breadcrumb">
                    <li><h5 class="bc-title">Accounts & HR</h5></li>
                    <li class="breadcrumb-item"><a href="javascript:void(0)">
                        <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.125 6.375L8.5 1.41667L14.875 6.375V14.1667C14.875 14.5424 14.7257 14.9027 14.4601 15.1684C14.1944 15.4341 13.8341 15.5833 13.4583 15.5833H3.54167C3.16594 15.5833 2.80561 15.4341 2.53993 15.1684C2.27426 14.9027 2.125 14.5424 2.125 14.1667V6.375Z"
                                  stroke="#2C2C2C" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M6.375 15.5833V8.5H10.625V15.5833" stroke="#2C2C2C" stroke-linecap="round"
                                  stroke-linejoin="round"/>
                        </svg>
                        Employee </a>
                    </li>
                </ol>
                <a class="btn btn-primary btn-sm" data-bs-toggle="offcanvas"
                   href="#offcanvasExample" role="button" aria-controls="offcanvasExample">+
                    Add Employee</a>

            </div>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title mb-0">Employee List </h4>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive table-card">
                                    <table class="table primary-table-bordered" id="employee-table">
                                        <thead class="thead-primary">
                                        <tr>
                                            <th>SR NO</th>
                                            <th>Profile Photo</th>
                                            <th>Employee ID</th>
                                            <th>Employee Name</th>
                                            <th>Email Address</th>
                                            <th>Contact Number</th>
                                            <th>Created By</th>
                                            <th>Created Date</th>
                                            <th>Action</th>
                                        </tr>
                                        </thead>
                                        <tbody id="employee-table-body">

                                        </tbody>

                                    </table>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div id="pagination-count" style="padding: 10px;">Showing 0 to 0 of 0 entries</div>
                                <div style="padding-bottom: 10px;margin: 5px;">
                                    <button id="prev-page-btn" class="btn btn-primary me-2">Previous</button>
                                    <button id="next-page-btn" class="btn btn-primary">Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!--**********************************
            Content body end
        ***********************************-->

        <!-- Employee Details Modal -->
        <div class="modal fade" id="employeeDetailsModal" tabindex="-1" role="dialog"
             aria-labelledby="employeeDetailsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="employeeDetailsModalLabel">Employee Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-md-4 text-center">
                                    <img id="employeeProfilePic" class="rounded-circle border" src=""
                                         alt="Employee Profile Picture" width="150" height="150"/>
                                </div>
                                <div class="col-md-8">
                                    <table class="table table-borderless table-hover">
                                        <tbody>
                                        <tr>
                                            <th>Employee ID:</th>
                                            <td id="modal_employee_id"></td>
                                        </tr>
                                        <tr>
                                            <th>Name:</th>
                                            <td id="modal_name"></td>
                                        </tr>
                                        <tr>
                                            <th>Designation:</th>
                                            <td id="modal_designation"></td>
                                        </tr>
                                        <tr>
                                            <th>Joining Date:</th>
                                            <td id="modal_joining_date"></td>
                                        </tr>
                                        <tr>
                                            <th>Date of Birth:</th>
                                            <td id="modal_dob"></td>
                                        </tr>
                                        <tr>
                                            <th>Blood Group:</th>
                                            <td id="modal_blood_group"></td>
                                        </tr>
                                        <tr>
                                            <th>Reporting To:</th>
                                            <td id="modal_reporting"></td>
                                        </tr>
                                        <tr>
                                            <th>Status:</th>
                                            <td id="modal_status"></td>
                                        </tr>
                                        <tr>
                                            <th>Permanent Address:</th>
                                            <td id="modal_p_address"></td>
                                        </tr>
                                        <tr>
                                            <th>Current Address:</th>
                                            <td id="modal_c_address"></td>
                                        </tr>
                                        <tr>
                                            <th>Country:</th>
                                            <td id="modal_country"></td>
                                        </tr>
                                        <tr>
                                            <th>State:</th>
                                            <td id="modal_state"></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Attachments section -->
                            <h4 class="mt-4">Attachments:</h4>
                            <div id="modal_attachments_container" class="attachments-container"></div>

                            <!-- Lightbox Modal for viewing attachments -->
                            <div id="lightbox" class="lightbox">
                                <span class="close">&times;</span>
                                <img class="lightbox-content" id="lightbox-img">
                                <div id="caption"></div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="closeDetailsBtn">Close</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Edit Employee Modal -->
        <div class="modal fade" id="editEmployeeModal" tabindex="-1" role="dialog"
             aria-labelledby="editEmployeeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editEmployeeModalLabel">Edit Employee</h5>
                    </div>
                    <div class="modal-body">
                        <!-- Employee Edit Form -->
                        <form id="editEmployeeForm" method="post">
                            {% csrf_token %}
                            <input type="hidden" id="editEmployeeIdHidden" name="id">

                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeId">Employee ID</label>
                                    <input type="text" class="form-control" id="editEmployeeId" name="emp_id">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeName">Name</label>
                                    <input type="text" class="form-control" id="editEmployeeName" name="name">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeEmail">Email</label>
                                    <input type="email" class="form-control" id="editEmployeeEmail" name="email">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeMobile">Mobile</label>
                                    <input type="text" class="form-control" id="editEmployeeMobile" name="mobile_no">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeDesignation">Designation</label>
                                    <select class="form-control" id="editEmployeeDesignation" name="designation">
                                        <option value="">Select Designation</option>
                                            <!-- Options will be added dynamically -->
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeGender">Gender</label>
                                    <select class="form-control" id="editEmployeeGender" name="gender">
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeJoiningDate">Joining Date</label>
                                    <input type="date" class="form-control" id="editEmployeeJoiningDate"
                                           name="joining_date">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeDOB">Date of Birth</label>
                                    <input type="date" class="form-control" id="editEmployeeDOB" name="dob">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeePAddress">Permanent Address</label>
                                    <textarea class="form-control" id="editEmployeePAddress"
                                              name="p_address"></textarea>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeCAddress">Current Address</label>
                                    <textarea class="form-control" id="editEmployeeCAddress"
                                              name="c_address"></textarea>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeCountry">Country</label>
                                    <input type="text" class="form-control" id="editEmployeeCountry" name="country">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeState">State</label>
                                    <input type="text" class="form-control" id="editEmployeeState" name="state">
                                </div>
                                <div class="col-md-2 mb-3">
                                    <label for="editEmployeeStatus">Status</label>
                                    <select class="form-control" id="editEmployeeStatus" name="status">
                                        <option value="true">Active</option>
                                        <option value="false">Inactive</option>
                                    </select>
                                </div>
                                <div class="col-md-2 mb-3">
                                    <label for="editBloodGroup">Blood Group</label>
                                    <input type="text" class="form-control" id="editBloodGroup" name="blood_group">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeReporting">Reporting To</label>
                                    <select class="form-control" id="editEmployeeReporting" name="reporting"></select>
                                </div>

                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeProfilePhoto">Profile Photo</label>
                                    <input type="file" class="form-control" id="editEmployeeProfilePhoto"
                                           name="profile_photo" accept="image/*">
                                    <div id="profilePicPreview" class="mt-2"></div>
                                    <!-- Container for profile picture preview -->
                                </div>

                                <div id="attachment-list" class="col-md-8 mb-3"></div>
                                <div class="col-md-4 mb-3">
                                    <label for="editEmployeeAttachments">Add Attachments</label>
                                    <input type="file" class="form-control" id="editEmployeeAttachments"
                                           name="attachments" multiple>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="closeFormBtn">Close</button>
                        <button type="button" class="btn btn-primary" id="saveChangesBtn">Save changes</button>
                    </div>
                </div>
            </div>
        </div>


        <!--**********************************
            Footer start
        ***********************************-->
        {% include 'product_tracking/footer.html' %}
        <!--**********************************
            Footer end
        ***********************************-->

        <!-- Add Employee -->
        <a class="btn btn-primary btn-sm" data-bs-toggle="offcanvas"
           href="#offcanvasExample" role="button" aria-controls="offcanvasExample" id="addEmployeeBtn">+
            Add Employee</a>

        <div class="offcanvas offcanvas-end customeoff" tabindex="-1" id="offcanvasExample">
            <div class="offcanvas-header">
                <h5 class="modal-title" id="#gridSystemModal">Add Employee</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="offcanvas-body">
                <form id="employee-form" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <label>Passport Photo</label>
                    <input name="profile_photo" type="file" accept=".jpg,.jpeg,.png">
                    <div class="row">
                        <div class="col-xl-6 mb-3">
                            <label for="exampleFormControlInput1" class="form-label">Employee ID <span
                                    class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="exampleFormControlInput1" name="employee_id"
                                   placeholder="" required>
                        </div>
                        <div class="col-xl-6 mb-3">
                            <label for="exampleFormControlInput2" class="form-label">Employee Name<span
                                    class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="exampleFormControlInput2" name="name"
                                   placeholder="" required>
                        </div>
                        <div class="col-xl-6 mb-3">
                            <label for="exampleFormControlInput3" class="form-label">Employee Email<span
                                    class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="exampleFormControlInput3" name="email"
                                   placeholder="" required>
                        </div>

                        <div class="col-xl-6 mb-3">
                            <label class="form-label">Designation</label>
                            <select class="form-control" id="exampleFormControlInput4" name="designation">
        <option value="">Select Designation</option>
        <!-- Options will be added dynamically -->
    </select>
                        </div>

                        <div class="col-xl-6 mb-3">
                            <label for="exampleFormControlInput88" class="form-label">Mobile<span
                                    class="text-danger">*</span></label>
                            <input type="tel" class="form-control" id="exampleFormControlInput88" name="mobile_no"
                                   placeholder="" maxlength="10" pattern="\d{10}" required>
                        </div>
                        <div class="col-xl-6 mb-3">
                            <label class="form-label">Gender<span class="text-danger">*</span></label>
                            <select class="style-1 form-control" name="gender">
                                <option data-display="Select">Please Select</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="col-xl-6 mb-3">
                            <label for="exampleFormControlInput99" class="form-label">Joining Date <span
                                    class="text-danger">*</span></label>
                            <input type="date" class="form-control" id="exampleFormControlInput99" name="joining_date">
                        </div>
                        <div class="col-xl-6 mb-3">
                            <label for="exampleFormControlInput8" class="form-label">Date of Birth <span
                                    class="text-danger">*</span></label>
                            <input type="date" class="form-control" id="exampleFormControlInput8" name="dob">
                        </div>
                        <div class="col-xl-6 mb-3">
                            <label for="exampleFormControlInputfour" class="form-label">Reporting To<span
                                    class="text-danger">*</span></label>
                            <select class="form-control" name="reporting" id="exampleFormControlInputfour" required>
                                <option value="">Select employee</option>
                                <!-- Options will be populated dynamically -->
                            </select>
                        </div>
                        <div class="col-xl-6 mb-3">
                            <label class="form-label">Permanent Address<span class="text-danger">*</span></label>
                            <textarea rows="3" class="form-control" name="p_address" required></textarea>
                        </div>
                        <div class="col-xl-6 mb-3">
                            <label class="form-label">Current Address<span class="text-danger">*</span></label>
                            <textarea rows="3" class="form-control" name="c_address" required></textarea>
                        </div>
                        <div class="col-xl-6 mb-3">
                            <label class="form-label">Country</label>
                            <select class="form-control" name="country">
                                <option data-display="Select">Please Select</option>
                                <option value="India" selected>India</option>
                                <option value="USA">USA</option>
                                <option value="UK">UK</option>
                            </select>
                        </div>

                        <div class="col-xl-6 mb-3">
                            <label class="form-label">State</label>
                            <input type="text" class="form-control" id="exampleFormControlInput8" name="state">
                        </div>

                        <div class="col-xl-6 mb-3">
                            <label class="form-label">Status<span class="text-danger">*</span></label>
                            <select class="form-control" name="status">
                                <option data-display="Select">Select Status</option>
                                <option value="true" selected>Active</option>
                                <option value="false">Inactive</option>
                            </select>
                        </div>
                        <div class="col-xl-6 mb-3">
                            <label class="form-label">Blood Group</label>
                            <input type="text" class="form-control" id="bloodGroup" name="bloodGroup">
                        </div>
                        <div id="attachments" class="col-xl-6 mb-3" style="margin-top: 18px;">
                            <label>Attachments(Aadhar Card/ Pan Card/ Driving Licence/ Passport/ Election Card):</label>
                            <div class="input-group">
                                <input type="file" name="attachments[]" accept=".jpg, .jpeg, .png" multiple>
                            </div>
                        </div>
                        {% if error %}
                            <div class="error">{{ error }}</div>
                        {% endif %}
                    </div>
                    <div>
                        <button class="btn btn-primary me-1">Submit</button>
                        <button class="btn btn-danger light ms-1" id="cancel-button">Cancel</button>
                    </div>
                </form>
            </div>
        </div>


        <!-- End Add Employee Section -->


    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->


    </body>
{% endblock %}
